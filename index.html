<html>
<head>
    <title>
        FreeCodeCamp KGISL
    </title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery library -->
    <script src="js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript">

        var arr=[];
        var points=0;
        var html='<table class="table" id="data"><tr><th>SNO</th><th>Avatar</th><th>Name</th><th>User Name</th><th>Points</th></tr>';
        $(document).ready(function(){
            $.getJSON('data.json', function(json) {
                //alert(json["array"].length
                var len=json["array"].length;
                var sum=0;
                for(var i=0;i<len;i++){
                    points=browniePointsFetcher(json["array"][i]["username"]);
                    sum+=points;
                    arr.push({avatar:json["array"][i]["avatarUrlSmall"],name:json["array"][i]["displayName"],uname:json["array"][i]["username"],points:points})
                }

                $("#campers").html('<h2><span class="label label-info">Total Campers:- '+len+'</span></h2>');


               arr.sort(function(a,b){
                    return a.points- b.points;
               });

                arr.reverse();
                var j=0;


                html+=arr.map(function (a) {
                    j++;
                    return '<tr><td>'+(j)+'</td>'+dataFormater(a.avatar, a.name, a.uname, a.points)+'</tr>';
                }).join('');
                html+='</table>';

                $("#data").html(html);

                var a=$("#data").html();


                //alert(a);
                $("#totalProblems").html('<h2><span class="label label-info">Total Problems:- '+sum+'</span></h2>');


            });

        });

        function browniePointsFetcher(uname){
            var points=0;
            var url='https://www.freecodecamp.com/api/users/about?username='+uname.toLowerCase();
            $.ajax({
                type:'GET',
                url:url,
                //data:data,
                async: false,
                dataType: 'json',
                success: function (data) {
                    //Do stuff with the JSON data
                    points=data["about"]["browniePoints"];
                },
                error:function(xhr, textStatus, errorThrown){
                    points=0;
                }
            });
            return points;
        }
        function dataFormater(image,name,uname,points){
            var temp_html='<td>';
            temp_html+='<img src='+image+' class="img-thumbnail" width="100px" ></img></td>';
            temp_html+='<td>';
            temp_html+='<h3>'+name+'</h3></td>';
            temp_html+='<td>';
            temp_html+='<h3><a href="http://freecodecamp.com/'+uname+'" target="_blank">'+uname+'</a></h3></td>';
            temp_html+='<td>';
            if(points===0){
                temp_html+='<h3><span class="label label-warning">'+points+'</span></h3></td>';
            }else{
                temp_html+='<h3>'+points+'</h3></td>';
            }

            return temp_html;
        }
    </script>

    <style type="text/css">
        .col-xs-3{
            border-color:#0f0f0f;
            border-width: 2px;
        }
    </style>

</head>
<body>
    <div class="container-fluid well">
        <div class="row text-center">
            <div class="col-xs-12">
                <h1><span class="label label-primary">Free Code Camp User Report</span></h1>
            </div>
        </div>
        <div class="row text-center">
            <div class="col-xs-6" id="campers">

            </div>
            <div class="col-xs-6" id="totalProblems">

            </div>

        </div>
        <br/>
        <br/>
        <div class="row text-center">
            <div class="col-xs-12" id="data">

            </div>
        </div>

    </div>
</body>

</html>