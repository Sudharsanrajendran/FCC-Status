<html>
<head>
    <title>
        FreeCodeCamp KGISL
    </title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery library -->
    <script src="js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript">
        var html="";
        var points=0;
        html='<table class="table" id="data"><tr><h1><th>SNO</th><th>Avatar</th><th>Name</th><th>User Name</th><th>Points</th></h1></tr>';
        $(document).ready(function(){

            $.getJSON('data.json', function(json) {

                //alert(json["array"].length);
                for(var i=0;i<json["array"].length;i++){
                    points=browniePointsFetcher(json["array"][i]["username"]);
                    //var points=5;
                    html+='<tr><td>'+(i+1)+'</td>'+dataFormater(json["array"][i]["avatarUrlSmall"],json["array"][i]["displayName"],json["array"][i]["username"],points)+'</tr>';
                }
                html+='</table>';
                //alert(html);
                $("#data").html(html);
            });

            //alert(html);
        });

        function browniePointsFetcher(uname){
            var points=0;
            var url='https://www.freecodecamp.com/api/users/about?username='+uname.toLowerCase();
            $.ajax({
                type:'GET',
                url:url,
                //data:data,
                async: false,
                dataType: 'json',
                success: function (data) {
                    //Do stuff with the JSON data
                    points=data["about"]["browniePoints"];
                },
                error:function(xhr, textStatus, errorThrown){
                    points="error";
                }
            });
            return points;
        }
        function dataFormater(image,name,uname,points){
            var temp_html='<td>';
            temp_html+='<img src='+image+' class="img-thumbnail" width="100px" ></img></td>';
            temp_html+='<td>';
            temp_html+='<h3>'+name+'</h3></td>';
            temp_html+='<td>';
            temp_html+='<h3><a href="http://freecodecamp.com/'+uname+'" target="_blank">'+uname+'</a></h3></td>';
            temp_html+='<td>';
            if(points==="error"){
                temp_html+='<h3><span class="label label-warning">'+points+'</span></h3></td>';
            }else{
                temp_html+='<h3>'+points+'</h3></td>';
            }

            return temp_html;
        }
    </script>

    <style type="text/css">
        .col-xs-3{
            border-color:#0f0f0f;
            border-width: 2px;
        }
    </style>

</head>
<body>
    <div class="container well">
        <div class="row text-center">
            <div class="col-xs-12">
                <h1><span class="label label-primary">Free Code Camp User Report</span></h1>
            </div>
        </div>
        <br/>
        <br/>
        <div class="row text-center">
            <div class="col-xs-12 table-responsive" id="data">

            </div>
        </div>

    </div>
</body>

</html>